<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ID Verifier — Knights of Columbus</title>
  <style>
    body {
      background: radial-gradient(circle at top, #1b2562, #0a0f24);
      color: white;
      font-family: Poppins, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
    }
    header {
      font-size: 28px;
      font-weight: 700;
      margin-top: 30px;
      text-shadow: 0 0 10px rgba(255,255,255,0.3);
    }
    #reader {
      width: 320px;
      margin-top: 30px;
    }
    #info {
      background: rgba(255,255,255,0.08);
      padding: 20px;
      border-radius: 12px;
      margin-top: 20px;
      display: none;
      width: 90%;
      max-width: 360px;
    }
    .back {
      margin-top: 25px;
      text-decoration: none;
      color: #fff;
      background: #198754;
      padding: 10px 18px;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <header>ID VERIFIER — KNIGHTS OF COLUMBUS</header>
  <div id="reader"></div>
  <div id="info"></div>
  <a href="index.html" class="back">Back to Encoder</a>

  <script src="https://unpkg.com/html5-qrcode"></script>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getDatabase, ref, get, child } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAj6RTJKEXGECPScRNwJvC2TBrrguUZjDY",
      authDomain: "kofc-ee899.firebaseapp.com",
      databaseURL: "https://kofc-ee899-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "kofc-ee899",
      storageBucket: "kofc-ee899.firebasestorage.app",
      messagingSenderId: "716219934839",
      appId: "1:716219934839:web:d2c87f1921748732fd7e72",
      measurementId: "G-KXZ2VN188G"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const reader = new Html5Qrcode("reader");
    reader.start({ facingMode: "environment" }, { fps: 10, qrbox: 250 },
      async (decodedText) => {
        reader.stop();
        const dbRef = ref(db);
        const snapshot = await get(child(dbRef, `ids/${decodedText}`));
        const infoDiv = document.getElementById("info");
        if (snapshot.exists()) {
          const data = snapshot.val();
          infoDiv.innerHTML = `
            <h3>Verified ID Information</h3>
            <p><b>Name:</b> ${data.name}</p>
            <p><b>Birthday:</b> ${data.bday}</p>
            <p><b>Blood Type:</b> ${data.blood}</p>
            <p><b>Date Issued:</b> ${data.issued}</p>
            <p><b>Date Expiry:</b> ${data.expiry}</p>
            <p style="color:#28a745;font-weight:bold;">✅ Verified from Database</p>
          `;
        } else {
          infoDiv.innerHTML = `<p style="color:#ff5b5b;">❌ No record found for this code.</p>`;
        }
        infoDiv.style.display = "block";
      },
      (errorMessage) => {}
    );
  </script>
</body>
</html>
